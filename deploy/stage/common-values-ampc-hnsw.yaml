image: "ghcr.io/worldcoin/iris-mpc-cpu:v0.30.0@sha256:bcdeb25a20263e1b48e0bebcbb7b1ed66c6248a426530c8167688b3333f23e74"

environment: stage
replicaCount: 1

strategy:
  type: Recreate

datadog:
  enabled: true

hostNetwork: false

ports:
  - containerPort: 3000
    name: health
    protocol: TCP
  - containerPort: 4000
    name: tcp-4000
    protocol: TCP
  - containerPort: 4001
    name: tcp-4001
    protocol: TCP
  - containerPort: 4002
    name: tcp-4002
    protocol: TCP

livenessProbe:
  httpGet:
    path: /health
    port: health

readinessProbe:
  periodSeconds: 30
  httpGet:
    path: /ready
    port: health

startupProbe:
  initialDelaySeconds: 60
  failureThreshold: 120
  periodSeconds: 30
  httpGet:
    path: /ready
    port: health

resources:
  limits:
    cpu: "6.5"
    memory: 100Gi
  requests:
    cpu: "6.5"
    memory: 100Gi

imagePullSecrets:
  - name: github-secret

podAnnotations:
  karpenter.sh/do-not-disrupt: "true"

nodeSelector:
  kubernetes.io/arch: arm64
  karpenter.sh/capacity-type: on-demand
  node.kubernetes.io/instance-type: "x8g.2xlarge"

podSecurityContext:
  runAsUser: 65534
  runAsGroup: 65534

preStop:
  # preStop.sleepPeriod specifies the time spent in Terminating state before SIGTERM is sent
  sleepPeriod: 10

# terminationGracePeriodSeconds specifies the grace time between SIGTERM and SIGKILL
# long enough to allow for graceful shutdown to safely process 2 batches
# single batch timeout in stage is 240 seconds
terminationGracePeriodSeconds: 240

mountSSLCerts:
  enabled: true
  mountPath: /etc/ssl/private
